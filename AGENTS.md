# garble hardened

This Agents.md file provides comprehensive guidance for AI agents working with this codebase.

## Project Structure for AI Agent Navigation

- `/`: Root directory containing main entry points and core transformation logic
  - `main.go`: Main CLI entry point that AI agents should analyze for command-line interface
  - `transformer.go`: Core obfuscation engine that AI agents should understand for modifications
  - `hash.go`, `position.go`: Key utility functions for name hashing and position obfuscation
- `/internal`: Internal packages that AI agents should analyze deeply
  - `/literals`: Literal obfuscation strategies (ASCON-128, simple obfuscators) that AI agents should understand for encryption features
  - `/ctrlflow`: Control-flow obfuscation with jump tables and dead code injection
    - `ctrlflow.go`: Auto vs all behavior and package/function eligibility rules
    - `transform.go`, `ssa.go`: SSA control-flow transforms and low-level helpers
    - `trash.go`, `hardening.go`: Trash generation and dispatcher hardening
  - `/cache`: Cache encryption and management for build reproducibility
  - `/linker`: Linker patches and modifications for Go toolchain integration
  - `/pipeline`: Build pipeline orchestration that AI agents should follow
  - `/asthelper`, `/ssa2ast`, `/typesutil`: AST and SSA transformation utilities
- `/docs`: Documentation that AI agents should reference for feature understanding
- `/scripts`: Build and utility scripts that AI agents may need to run or modify
- `/testdata`: Test fixtures and data that AI agents should use for validation

## Available Skills

AI agents can leverage specialized skills for different tasks:

- [@skill golang-concurrency-patterns](golang-concurrency-patterns/SKILL.md) - Master Go concurrency with goroutines, channels, sync primitives, and context
- [@skill golang-patterns](golang-patterns/SKILL.md) - Idiomatic Go patterns, best practices, and conventions
- [@skill golang-performance](golang-performance/SKILL.md) - Profiling, benchmarking, and optimization techniques
- [@skill golang-testing](golang-testing/SKILL.md) - Go testing patterns including table-driven tests, subtests, benchmarks, and fuzzing

## Coding Conventions for AI Agent Implementation

### General Conventions for Agents.md Implementation

- Use Go 1.25+ features and standard library patterns
- AI agents should follow Go naming conventions: PascalCase for exported, camelCase for unexported
- Meaningful variable and function names in AI agent generated code
- AI agents should add comments for complex obfuscation logic as guided by Agents.md
- Follow the existing error handling patterns using Go's standard error wrapping

### Go Package Guidelines for AI Agent Code

- AI agents should use internal packages for implementation details
- Keep packages focused on single responsibilities (e.g., literals for literal obfuscation)
- AI agents must follow Go module conventions with proper import paths
- Use `github.com/AeonDave/garble` as the module path in AI agent generated code

### Security and Obfuscation Standards for AI Agent Code

- AI agents should implement defense-in-depth with multiple obfuscation layers
- Use cryptographically secure random generation for seeds and nonces
- AI agents should ensure deterministic builds when seeds are provided
- Follow the security principles documented in docs/SECURITY.md

## Control-flow Guidance for AI Agents

- `controlflow=auto` is conservative and should stay stable by default.
  - Hard skips always apply: critical stdlib (`runtime`, `syscall`, `unsafe`, `golang.org/*`) and cgo packages.
  - Soft skips for auto: functions with `//go:` directives and bound method closures.
  - Predeclared names are now allowed in auto.
- `controlflow=all` is for broader coverage and experimentation; keep it permissive where safe.
- Use `GARBLE_CONTROLFLOW_DEBUG=1` to get skip reasons in logs.
- Prefer adding tests in `internal/ctrlflow/*_test.go` when changing control-flow behavior.

## Testing Requirements for AI Agent Code

AI agents should run tests with the following commands:

```bash
# Run all tests with AI agent code
go test ./...

# Run specific package tests with AI agent
go test ./internal/literals

# Run control-flow specific tests
go test ./internal/ctrlflow

# Run tests with race detection for AI agent concurrency code
go test -race ./...

# Run fuzz tests for AI agent security-critical code
go test -fuzz=FuzzObfuscate -fuzztime=30s ./internal/literals
```

## Pull Request Guidelines for AI Agent Contributions

When AI agents help create a PR, please ensure it:

1. Includes a clear description of the obfuscation changes or security enhancements
2. References any related issues or security considerations
3. Ensures all tests pass for code generated by AI agents
4. Includes test cases for new obfuscation features
5. Keeps PRs focused on a single feature or bug fix as specified in Agents.md
6. Updates documentation in `/docs` if introducing new features

## Programmatic Checks for AI Agent Code

Before submitting changes generated by AI agents, run:

```bash
# Format check for AI agent Go code
go fmt ./...

# Lint check for AI agent code quality
go vet ./...

# Type check for AI agent Go code
go build ./...

# Test check for AI agent implementations
go test ./...

# Security check for AI agent code (if available)
# Custom security linting tools as documented in docs/SECURITY.md
```

All checks must pass before AI agent generated code can be merged. Agents.md helps ensure AI agents follow these requirements.
